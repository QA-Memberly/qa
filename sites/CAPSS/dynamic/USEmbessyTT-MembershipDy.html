<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="description" content="">
      <meta name="generator" content="Jekyll v4.1.1">
      <title>Membership</title>
      <link href="../assets/dist/css/selectize/normalize.css" rel="stylesheet">
      <link href="../assets/dist/css/selectize/selectize.default.css" rel="stylesheet">
      <link href="../assets/dist/css/custom-formio/theme.less.css" rel="stylesheet">
	  <link href="../assets/dist/css/main.css" rel="stylesheet">
      <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'>
      <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css'>
      <link href="../assets/dist/css/custom-formio/formio.full.min.css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.core.min.js" integrity="sha512-w66UYDpfZgAuo4abswC7aUEQ1zdJc8/EwjlwlcOcrK6V6PLcnhWb+hKukf69JyeZ2lwMjeaCPBMpl4ep15d9nA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js" integrity="sha512-90vH1Z83AJY9DmlWa8WkjkV79yfS2n2Oxhsi2dZbIv0nC4E6m5AbH8Nh156kkM7JePmqD6tcZsfad1ueoaovww==" crossorigin="anonymous"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdn.rawgit.com/meetselva/attrchange/master/js/attrchange.js"></script>
      <script src='../assets/dist/js/investigate/selectize.js'></script>
	  <script src='../assets/dist/js/main.js'></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
      <script src='https://unpkg.com/formiojs@latest/dist/formio.full.min.js'></script>
      <script>
		var globalForm = null;

		$(document).ready(function () {
		
			var formDefinitionDept = "US-Embassy-Membership";
			var docvars = getUrlVars();
			
			var formDefinitionUrl = "https://qa.servicedx.com/admin/departments/" + formDefinitionDept;
			var membershipUrl = "https://qa.servicedx.com/filing/membership/formio/departments/"+docvars.departmentName+"/users/"+docvars.userName;
			var membershipByIdUrl = "https://qa.servicedx.com/filing/membership/formio/membership_id/"+docvars.membershipId;
			//var membershipUrl = "http://localhost:9104/filing/membership/formio/departments/"+docvars.departmentName+"/users/"+docvars.userName;
			//var membershipByIdUrl = "http://localhost:9104/filing/membership/formio/membership_id/"+docvars.membershipId;
			
			var formDefComponent = getFormComp(formDefinitionUrl, "membership");
			var formObj = null;
			var isMember = true;
			
			if (docvars.loggedInRole.toLowerCase() == "user"){
			  formObj = getFormObj(membershipUrl);
			  if(!formObj.data.hasOwnProperty('errorCode')){
				var formObjParsed = JSON.parse(formObj.data);
				  if(formObjParsed.membershipId == null){ 
					console.log('non member');
					console.log(formObj.data.membershipIds)
					isMember = false;
				  }
			  }
			  
			}else {
				if(docvars.membershipId == "null" || docvars.membershipId == ''){
					formObj = getFormObj(membershipUrl);
					if(!formObj.data.hasOwnProperty('errorCode')){
					var formObjParsed = JSON.parse(formObj.data);
					  if(formObjParsed.membershipId == null){ 
						console.log('non member');
						console.log(formObj.data.membershipIds)
						isMember = false;
					  }
				  }
				}else{
					formObj = getFormObj(membershipByIdUrl);
				}
			}
			
			console.log('formObj',formObj);
			var forIO = Formio.createForm(document.getElementById('builder'), formDefComponent)
				.then(function (form) {
					var userObj;
					if(!formObj.data.hasOwnProperty('errorCode')){
						userObj = editObject(formObj, isMember);
						console.log(userObj);
					}else if(formObj.data.hasOwnProperty('errorCode') && formObj.data.errorCode == ("SDX_FILING_110")){
						//window.alert('User does not exist in database');
						userObj = {};
					}else{
						userObj = {};
					}
					
					form.submission = { data: userObj };
					
					console.log('userObj',form.submission);
					
					globalForm = form;
					//form.setPristine(false);
					form.nosubmit = true;
					form.on('submit', function (submission) {

						var userObject = submission.data;
						console.log("B4 : userObject : " + JSON.stringify(userObject));

						delete userObject["submit"];
						delete userObject["addressProof1"];
						delete userObject["registeredNurseDocument1"];
						delete userObject["recentPicture1"];
						delete userObject["addressProofPic"];
						delete userObject["termsAndCondition"];
						delete userObject["socialMedia"];
						delete userObject["person"];
						delete userObject["payment"];
						delete userObject["paymentStatus"];
						delete userObject["role"];
						delete userObject["specialSkills"];
						delete userObject["maritalStatus1"];
						delete userObject["birthDate1"];
						delete userObject["anniversaryDate1"];
						delete userObject["isMember"];
						
						userObject["departmentName"] = docvars.departmentName;
						userObject["userName"] = docvars.userName;
						userObject["membershipStatus"] = "Approved";
						userObject["approvedDate"] = now();
						//userObject["receiptNo"] = "";
						userObject["active"] = true;
						
						console.log("AF : " + JSON.stringify(userObject))
						
						if(!isMember){
							fetchAPI("https://qa.servicedx.com/filing/membership/formio", options(JSON.stringify(userObject), isMember)).then(response => {
								if(!response.hasOwnProperty('errorCode')){
									form.emit('submitDone', 'Create Success')
								}else{
									form.emit('submitError', response.message);
								}
							}).catch(function(error) {
								console.log("error fetch",error);
							});
						}else{
							fetchAPI("https://qa.servicedx.com/filing/membership/formio/" + userObject.membershipId, options(JSON.stringify(userObject), isMember)).then(response => {
								if(!response.hasOwnProperty('errorCode')){
									form.emit('submitDone', 'Update Success')
								}else{
									form.emit('submitError', response.message)
								}
							}).catch(function(error) {
								console.log("error fetch",error);
							});
						}

					});

				});

		});

		function editObject(formObj, isMember){
				var json = JSON.parse(formObj.data);
				console.log(json);
				var docvars = getUrlVars();
				
				if (!isMember) {
					console.log('if');
					if (docvars.loggedInRole.toLowerCase() == "user") {
						json["recommendedBy"] = "User";
					} else {
						json["recommendedBy"] = "Supervisor";
					}
					console.log('json.addressProof',json.addressProof);
					if(json.addressProof != null){
						json["addressProof1"] = JSON.parse(json.addressProof);
					}else{
						json["addressProof1"] = [];
					}
					
				}else {
					console.log('else');
					json["socialMedia"] = json.referredByValue;
					json["person"] = json.referredByValue;
					json["termsAndCondition"] = true;
					if (json.receiptNo != null || json.receiptNo != "" && json.receiptNo != undefined && json.paymentMode != null || json.paymentMode != "" && json.paymentMode != undefined ) {
						json["paymentStatus"] = "Success";
						json["payment"] = true;
					}
					
					if(json.registeredNurseDocument != null){
						json["registeredNurseDocument1"] = JSON.parse(json.registeredNurseDocument);
					}else{
						json["registeredNurseDocument1"] = [];
					}
					if(json.recentPicture != null){
						json["recentPicture1"] = JSON.parse(json.recentPicture);
					}else{
						json["recentPicture1"] = [];
					}
					if(json.addressProof != null){
						json["addressProof1"] = JSON.parse(json.addressProof);
					}else{
						json["addressProof1"] = [];
					}
					
					if (docvars.loggedInRole.toLowerCase() == "user") {
						json["recommendedBy"] = "User";
					} else {
						json["recommendedBy"] = "Supervisor";
					}
				}
				
				var otherInterests = {};
				for (i = 0; i < json.otherInterests.length; i++) {
				  otherInterests[json.otherInterests[i]] = true; 
				}
				
				json["anniversaryDate1"] = json.anniversaryDate;
				json["birthDate1"] = json.birthDate;
				json["personName"] = json.referredByValue;
				json["socialMedia"] = json.referredByValue;
				json["specialSkills"] = otherInterests;
				if(json.maritalStatus != "married" && json.maritalStatus != "unmarried" && json.maritalStatus != "divorced" ){
					json["maritalStatus1"] = "others";
					json["others"] = json.maritalStatus;
				}
				json["role"] = docvars.loggedInRole;
				json["isMember"] = isMember;
				console.log(json);
			return json;
		}

      </script>
      <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet">
      <style>body { font-family:'Poppins', sans-serif!important; overflow-x: hidden!important; }
         .card-header {
         padding: 5px;
         margin-bottom: 0;
         background-color: rgba(0,0,0,.03);
         border-bottom: 1px solid rgba(0,0,0,.125);
         }
         .formio-component,.form-control,.select2-selection__rendered {
         font-size:15px!important;
         }
         .select2-selection__rendered, .select2-selection--multiple{
         background-color: #e8f0fa!important;
         }
         .select2-selection--multiple{
         padding-left: 4px!important;
         }
         .select2-container--bootstrap4 .select2-selection {
         border: 1px solid #d3dae8!important;
         } 
         .card-body {
         padding: 5px 10px!important;
         }
         .select2-selection__choice__remove{
         border:none;background:transparent;color:#fff!important;
         }
         .select2-search__field {
         background:transparent;
         }
         .select2-selection__choice__display{
         font-size:13px!important;
         color:#fff!important;
         }
		 .head{
			margin-top: 15px;
         }
      </style>
   </head>
   <body style="padding:10px;background-color: #dde0e0;">
      <div id="wrapper">
         <div id="loader" class="hidden">
            <div id="loaderCircle"></div>
         </div>
         <div id="initScreen" style="display: block;">
            <div class="section" id="a67a329f1c344dfd887b3efc8a413ed3">
               <div class="screen" id="survey-screen-1" style="background-color: rgb(245, 249, 250);">
                  <div class="main-container">
                     <div id="survey-section" class="">
                        <div class="survey-sub-screen multiplechoice-question-component" id="survey-sub-screen-half-n-half">
                           <div class="head">
                           </div>
                           <div class="question-answer-row" id="section" style="padding-left:10px;padding-right:10px;">
                              <div class="question-answer-cell">
                                 <div id='builder'></div>
                              </div>
							  <div class="question-answer-cell">
                                 <div id='formio'></div>
                              </div>
                           </div>
                           <div class="question-answer-row" style="display:none;">
                              <div class="question-answer-cell">
                                 <div class="question-section-row">
                                    <div id="question-section" class="">How old are you?</div>
                                 </div>
                                 <div class="table" id="options-section" style="color: rgb(63, 127, 241);">
                                    <div class="table-row options-title-row">
                                       <div class="options-title">Select One</div>
                                    </div>
                                    <div class="table-row"  style="display:none;">
                                       <div class="options-content-container">
                                          <div class="options-content">
                                             <div class="question-695d225da68f4a42acc389c83e165f29 invisible-scrollbar" style="width: 100%; max-height: 100%;">
                                                <style>.icon-selection { color: #3f7ff1 !important } .icon-selected { color: #3f7ff1 !important } .icon-unselected { color: #3f7ff1 !important } .submit-button-container .submit-button.active { background-color: #3f7ff1 }</style>
                                                <div class="options-list-container">
                                                   <style>.multiple-choice-option.selected { color: #3f7ff1; border-color: #3f7ff1 } .submit-button-container .submit-button.active { background-color: #3f7ff1 }</style>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="27741a5d005a478f98b5fcaeda723526">
                                                      <div class="icon-checkbox icon-check" data-option-id="27741a5d005a478f98b5fcaeda723526" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="27741a5d005a478f98b5fcaeda723526" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">&lt; 14</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="6c37f5c3044442c2b94791e8423d8c04">
                                                      <div class="icon-checkbox icon-check" data-option-id="6c37f5c3044442c2b94791e8423d8c04" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="6c37f5c3044442c2b94791e8423d8c04" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">14-17</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="aa95d0d30f20423393d639a0f38b3e16">
                                                      <div class="icon-checkbox icon-check" data-option-id="aa95d0d30f20423393d639a0f38b3e16" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="aa95d0d30f20423393d639a0f38b3e16" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">18-24</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="e95fb4d3173a4d04b727e62437166b27">
                                                      <div class="icon-checkbox icon-check" data-option-id="e95fb4d3173a4d04b727e62437166b27" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="e95fb4d3173a4d04b727e62437166b27" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">25-34</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="e2b8a669ec034ef4a317379bad2e2f8d">
                                                      <div class="icon-checkbox icon-check" data-option-id="e2b8a669ec034ef4a317379bad2e2f8d" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="e2b8a669ec034ef4a317379bad2e2f8d" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">35-44</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="f40ba0f5d9944009af2f3b4c30f6afbb">
                                                      <div class="icon-checkbox icon-check" data-option-id="f40ba0f5d9944009af2f3b4c30f6afbb" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="f40ba0f5d9944009af2f3b4c30f6afbb" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">45-54</div>
                                                   </div>
                                                   <div class="multiple-choice-option" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0" data-option-id="b657f78427fc4caebc35c18363e0459b">
                                                      <div class="icon-checkbox icon-check" data-option-id="b657f78427fc4caebc35c18363e0459b" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0"></div>
                                                      <div class="text-content" data-option-id="b657f78427fc4caebc35c18363e0459b" data-question-id="695d225da68f4a42acc389c83e165f29" data-bucket-id="0">55+</div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                          <div class="more-options-below hidden" data-action="scroll-to-bottom">
                                             More options &nbsp;
                                             <span class="icon-down-arrow" data-action="scroll-to-bottom">c</span>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="privacy-policy-row" style="display:none">
                              <div class="privacy-policy-container">
                                 <div id="privacy-policy-text" class="privacy-policy-text">By clicking the button above, you agree to our
                                    <span id="privacy-policy-button" class="" style="color: unset; background-color: unset;">Privacy Policy</span>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="footer-row">
                        <div class="footer hide-submit">
                           <div id="logo-container">
                              <img style="width:50px;height:40px;" id="logo" src="https://static.wixstatic.com/media/eaa914_9cf3646c1306425db2dc5191490521f2~mv2.png/v1/crop/x_0,y_21,w_340,h_274/fill/w_121,h_96,al_c,q_85,usm_0.66_1.00_0.01/logo_edited.webp" alt="Logo" class="">
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div id="main-error-container" class="hidden">
            <div id="error-message">Something went wrong. Please retry.</div>
            <div id="retry-button">Retry</div>
         </div>
         <div id="privacy-policy-modal" class="hidden">
            <div class="title-row table-row">
               <div class="table-cell title-container">
                  <div class="title">Privacy Policy</div>
                  <div id="privacy-policy-close"><button type="button" class="close" aria-label="Close">
                     <span aria-hidden="true">&times;</span>
                     </button>
                  </div>
               </div>
            </div>
            <div class="table-row">
               <div class="table-cell content-container">
                  <div class="content"><strong>HOW WE USE INFORMATION WE COLLECT</strong><br>
                     How we use the information we collect depends in part on which Services you use, how you use them, and any preferences you have communicated to us. Below are the specific purposes for which we use the information we collect about you.
                     <br>We collect and use your information only where:
                     <br>•	We need it to provide you the Services, including to operate the Services, provide customer support and personalized features and to protect the safety and security of the Services;
                     <br>•	It satisfies a legitimate interest (which is not overridden by your data protection interests), such as for research and development, to market and promote the Services and to protect our legal rights and interests;
                     <br>•	You give us consent to do so for a specific purpose; or
                     <br>•	We need to process your data to comply with a legal obligation.
                     <br>•	If you have consented to our use of information about you for a specific purpose, you have the right to change your mind at any time, but this will not affect any processing that has already taken place. Where we are using your information because we or a third party (e.g. your employer) have a legitimate interest to do so, you have the right to object to that use though, in some cases, this may mean no longer using the Services.
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>